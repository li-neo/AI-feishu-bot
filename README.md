# 飞书AI周报推送与智能问答机器人解决方案

本方案指导开发人员实现一个飞书机器人，具备定时推送AI周报至群组，以及响应群聊@消息并调用大模型进行问答的能力。

---

## 步骤一：创建企业自建应用并配置机器人能力

1. 登录[飞书开发者后台](https://open.feishu.cn/app)，创建企业自建应用，记录 App ID 和 App Secret。
2. 在应用管理页面，进入“应用能力 > 添加应用能力”，添加**机器人**能力。详情参考：[如何启用机器人能力](https://go.feishu.cn/s/6dFbxHpwQ02)。
3. 在“权限管理”页面，申请以下应用身份权限：
   - `im:message:send_as_bot`：以应用身份发送消息
   - `im:message.group_at_msg:readonly`：接收群聊中@机器人消息事件
   - `im:chat:read`：获取群组信息
4. 权限申请后，发布应用版本使配置生效。

---

## 步骤二：配置事件订阅，接收群聊@消息

1. 进入“事件与回调 > 事件配置”页面，选择订阅方式为**使用长连接接收事件**。参考：[使用长连接接收事件](https://go.feishu.cn/s/626tU7DxM0s)。
2. 添加**接收消息**事件（`im.message.receive_v1`）。详情参考：[接收消息事件文档](https://go.feishu.cn/s/61BYfeQR80s)。
3. 事件处理逻辑：
   - 解析事件体，判断消息类型和内容。
   - 对群聊中@机器人的消息进行特殊处理（通过`message.chat_type`区分单聊/群聊）。

---

## 步骤三：AI周报推送功能实现

1. 获取目标群组ID：
   - 调用[获取用户或机器人所在的群列表](https://go.feishu.cn/s/61BYfgpwc01)接口，获取群组列表。
   - 或在飞书客户端通过群设置获取群ID。
2. 构造周报消息内容：
   - 使用[发送消息](https://go.feishu.cn/s/61BYfgpwE01)接口，发送富文本或卡片消息至群组。
   - 支持@指定成员或@所有人，格式参考[消息@人功能](https://go.feishu.cn/s/60d1Y6W0s02)。
3. 定时推送实现：
   - 在服务端设置定时任务（如每周五下午）。
   - 定时调用发送消息接口，将周报推送至指定群组。

---

## 步骤四：@消息问答处理功能实现

1. 接收@机器人消息：
   - 通过已订阅的接收消息事件，获取@机器人的消息。
   - 从事件体中提取`message_id`、`chat_id`和消息内容。
2. 调用大模型处理：
   - 将提取的消息内容发送至大模型API。
   - 获取大模型返回结果。
   - [缺少实现细节: 大模型API调用方式]
3. 回复消息：
   - 使用[回复消息](https://go.feishu.cn/s/61BYfeQRw0s)接口，回复群聊消息。
   - 传入`message_id`和处理后的回复内容。

---

## 步骤五：应用发布与测试

1. 配置应用可用范围：
   - 在“版本管理与发布”页面设置应用可用范围，确保目标测试用户在可用范围内。
2. 发布应用版本：
   - 创建版本并提交审核。
   - 测试环境可使用[测试企业与人员](https://go.feishu.cn/s/63g3FAPNs01)功能免审核发布。
3. 功能测试：
   - 将机器人添加至目标群组。
   - 测试@机器人问答功能和周报推送功能。

---

## 总结

通过上述步骤，开发人员可实现一个飞书机器人，具备定时推送AI周报至群组，以及响应群聊@消息并调用大模型进行智能问答的能力。所有关键接口和操作均已提供官方文档链接，可直接用于开发落地。